## 目标
* 在Linux上编译运行 ffmpeg tutorial01.c

## 环境
* Ubuntu 14.04 64bit
* FFmpeg 3.0 （ git clone @ 2016.05.24，N-80072-g8441759 ）
* tutorial （ UPDATE: This tutorial is up to date as of February 2015 ）
* 由于 tutorial 是2015年2月更新的，使用的是当时的ffmpeg函数/结构体。而目前是2016年5月，一些函数/结构体已经被弃用了，所以会有warning。后面会讲到怎么处理。

## 过程 （使用ffmpeg静态库）
1. 下载 ffmpeg 源码并编译——静态库方式
	* 默认的 configure 就是静态方式，所以使用默认的 `./configure`
	* make
	* sudo make install
	* 注：因为 tutorial 只用到了 ffmpeg 来解码，所以不需要额外安装 libx264 等第三方库，这些库是用来编码的。
	* 编译出来的静态库（libavformat.a 等等）被安装到 `/usr/local/lib/` 里了
	* 头文件被安装到 `/usr/local/include/` 里了
2. 下载 tutorial01.c 并编译
	* 注意，tutorial.c 里推荐的编译命令是：`gcc -o tutorial01 tutorial01.c -lavformat -lavcodec -lswscale -lz`，这是用于动态库的
	* 使用静态库的编译命令是这样：`gcc -o tutorial01 tutorial01.c -lavformat -lavcodec -lavutil -lswscale -lswresample -lm -lpthread`
	* 加上了 `-lavutil -lswresample -lm -lpthread`，去掉了 `-lz`
	* 解决 error：`PIX_FMT_RGB24` 没有声明的问题。 把 tutorial01.c 里所有的`PIX_FMT_RGB24`替换成`AV_PIX_FMT_RGB24`即可。
	* 这个error应该是ffmpeg 3.0 和 2.x 不兼容引起的。在ffmpeg2.5上不存在这个问题。


## 过程 （使用ffmpeg动态库）
1. 下载 ffmpeg 源码并编译——动态库方式
	* 不能用默认的 `./configure`，要加上以下选项，以便编译出动态库而不是静态库：
	
			./configure --disable-static --enable-shared

	* make
	* sudo make install
	* 编译出来的静态库（libavformat.so.57 等等）被安装到 `/usr/local/lib/` 里了
	* 头文件被安装到 `/usr/local/include/` 里了
2. 下载 tutorial01.c 并编译
	* 解决 error：`PIX_FMT_RGB24` 没有声明的问题。 把 tutorial01.c 里所有的`PIX_FMT_RGB24`替换成`AV_PIX_FMT_RGB24`即可。
	* 这个error应该是ffmpeg 3.0 和 2.x 不兼容引起的。在ffmpeg2.5上不存在这个问题。
	* 基本上按照 tutorial01.c 里面的编译命令执行就可以，注意
		* 不用加 -lz
		* 需要加上 -lavutil
		* 运行 tutorial01 之前，需要把 `/usr/local/lib/` 里的库拷贝到 `/usr/lib/` 里

### 删除之前安装的ffmpeg库，重新编译安装：

	sudo make uninstall
	sudo make clean

## 处理tutorial中弃用的ffmpeg函数/结构体
* 不处理也不影响使用
* 弃用的函数/结构体如下：
	* `AVFormatContext` 里的 `stream[n]`(`AVStream` 类型的) 里的 `codec`（`AVCodec` 类型的）弃用了。改用 `AVCodecParameters` 类型的 `codecpar` 了
	* `avpicture_get_size()` 弃用了，改用 `av_image_get_buffer_size()`
	* `avpicture_fill()` 弃用了，改用 `av_image_fill_arrays()`
	* `avcodec_decode_video2()` 弃用了，改用 `avcodec_send_packet()` 和 `avcodec_receive_frame()`
	* `av_free_packet() `弃用了，改用 `av_packet_unref()`

### 方案1：修改tutorial代码，用最新ffmpeg函数/结构体替换弃用的那些

### 方案2：不修改tutorial代码，使用老版本的ffmpeg