### 如果不考虑音视频同步，视频怎么播
* 在显示一副画面之前，计算delay： delay = 当前画面的pts - 前一副画面的pts。
* 测试了10个不同格式的文件，平均有百分之20到百分之45的视频帧，其pts==前一帧的pts。
* 20%~45%，这个比例不少，所以我们必须处理这种情况。
	* 如果 delay 等于 0，则让 delay = 0.01 。
* 延迟 delay 秒，再显示。 

### 如果不考虑音视频同步，音频怎么播
* 音频设备按照freq（sample rate）去播，每当播完了，就调用回调函数要数据
* 回调函数去packet队列里拿出一定数量的packet（可能是1个，不到1个，多于1个），解码出一定的数据，送给音频设备继续播。
* 音频播放没有考虑pts，就是一直在播。

### 音视频同步

##### 维护音频 pts： `is->audio_clock`
* 虽然音频一直往前播，不考虑pts。但是为了音视频同步，所以需要维护一份音频的 pts，好让视频知道音频播到第几秒了。
* `is->audio_clock` 表示目前音频播放到了第几秒。
* 每当音频回调函数取出一个 pkt，就把当前 pkt 的 pts（乘以 time base 转换成秒的）赋给 `is->audio_clock`。
* 如果这个 pkt 解码出了一定的音频数据，则再把这些音频数据能播放的秒数加到 `is->audio_clock` 上。

##### 用视频去跟音频同步
* 在播放视频的时候，如果不考虑跟音频同步，只需要 delay （当前画面的pts - 前一副画面的pts）即可。
* 现在考虑跟音频同步，则先计算一下当前视频的pts和音频的pts差多少。
* 如果视频的pts比音频的pts小很多，说明视频慢了，此时我们把 delay 设为0，让视频尽可能快的播。
* 如果视频的pts比音频的pts大很多，说明视频快了，此时我们把 delay 设为2*delay，让视频慢下来。
* 这里的“很多”被写死成了 0.01 秒。