# JNI 原理与入门 - HelloWorld


- JNI = Java Native Interface 
- 是java调用C语言用的
- 是java调用 “用C语言代码编译出来的库” 用的
- 因为用C语言编写的程序是不可移植的，是平台相关的，所以这种代码一般叫做Native Code
- 举例来说，同C语言在Windows上写了一个HelloWorld，用VC编译成了dll，这个dll拿到Linux上是运行不起来的。
- 这就是为什么叫做 “Native” Interface了
- 其实只要符合JNI，其他语言的代码写的平台相关的库，也可以被java调用，不过一般是用作调C/C++的

====================================

##例一 HelloWorld：

* 1、用记事本写一个最简单的HelloWorld.java ， 不过其中打印“HelloWorld”那句话交给C语言去完成，别再System.out.println()

```java
public class HelloWorld {
    public native void displayHelloWorld();
    static {
        System.loadLibrary("hello");
    }
    public static void main(String[] args) {
        new HelloWorld().displayHelloWorld();
    }
}
```

注1：public native void displayHelloWorld(); 这句话把displayHelloWorld()方法声明为native的，也就是说这个方法由C语言的库来提供，我们不要去实现它。那么C语言的库在哪里呢？看注2。
注2：System.loadLibrary("hello"); 这句话的意思就是加载C语言的hello这个库，这个库在Windows上可以是一个dll文件，一会儿我们会写相应的C代码去实现displayHelloWorld()，并编译成dll文件供java使用。
注3：System.loadLibrary("hello"); 这句话一般写在static块里，static{}不是这篇的重点，不解释

2、我们先把这个HelloWorld.java编译成class字节码
javac HelloWorld.java


3、下面我们用C语言来实现displayHelloWorld()，记事本新建一个文件叫HelloWorldC.c，内容如下：
#include"jni.h"

JNIEXPORT void JNICALL Java_HelloWorld_displayHelloWorld(JNIEnv *env,jobject obj)
{
	printf("Helloworld!\n");
	return;
}
注1：include必须要有，jni.h是java sdk提供给我们的，具体路径在：%java_home%\include 
注2：这个函数名必须是前缀Java_包名_类名_C函数名，参数必须是(JNIEnv* env,jobject obj,其他参数,..)。
我们可以去HelloWorld.h里复制。

4、写好c文件之后，我们编译它，生成dll。
注意，生成的dll文件名必须叫hello.dll，因为我们的java代码里load的就是“hello”（System.loadLibrary("hello");）
如何把c文件编译生成dll不是本文的重点，我们必须得到hello.dll就对了。关于如何编译，对于没有安装VC++的Windows机器，要么就安装一个，要么就参考这篇文章：
http://zsl-oo7.blog.163.com/blog/static/3532970320141119101210869/

5、好了，在保证hello.dll和HelloWorld.class在同一目录下的时候，我们运行java HelloWorld，就可以看到打印输出了
 
====================
让 Java 自动帮我们生成C函数名。
Java提供了一个工具，javah.exe，能根据你的Java代码，自动帮你生成需要的C函数的函数名，并保存成一个.h文件。
具体用法：
javah 包名.类名
注意：jdk 1.6 javah 需要的参数是.class文件，jdk 1.7 需要的是.java文件。也就是说，如果你用的是jdk1.6，则需要先把java编译成字节码才能运行javah。
在我们上面的例子里（jdk1.6），编译好 HelloWorld.class后，我们运行：
javah HelloWorld

注1：保证执行javah命令的目录中，存在HelloWorld.class
注2：不要写成 javah HelloWorld.class
 
执行完javah命令之后，会生成一个HelloWorld.h的文件，其内容如下：
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class HelloWorld */

#ifndef _Included_HelloWorld
#define _Included_HelloWorld
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     HelloWorld
 * Method:    displayHelloWorld
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_HelloWorld_displayHelloWorld
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif



可以看到，他自动生成了函数名及参数，我们可以直接从里面复制。

当工程量大了以后，生成这个头文件给C语言程序员去用是很必要的。