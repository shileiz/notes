### 测试程序

	:::c
	/*
	 * SimpleSection.c
	 */	
	int printf(const char* format, ...);
	
	int global_init_var = 84;
	int global_uninit_var;
	
	void func1(int i)
	{
		printf("%d\n",i);
	}
	
	int main(void)
	{
		static int static_var = 85;
		static int static_var2;
		int a = 1;
		int b;
		func1(static_var + static_var2 + a + b);
		return a;
	}


---

###符号
* 符号是个广义的概念，不光程序员在程序中定义（或引用）的变量名，函数名是符号
* 目标文件中的段名，以及其他一些编译器生成的东西（比如记录源文件的，记录行号的）也是符号
* 比如，.text 是一个符号，它代表着一个段。.text 这个符号的值代表这个段的起始地址（在目标文件中都为0，链接后变成在可执行文件中的偏移量）
* 而 func1 也是一个符号，它代表着一个函数，该函数位于 .text 段。同样是符号，func1 位于 .text 。
* func1 这个符号的值代表着他在他所在的段内的偏移量。
* 总结一下：
* 段名符号的值代表着该段的起始地址，在目标文件中都为0。
* 变量名、函数名符号的值代表着该符号在自己所在段内的偏移量。
* （段在 relocatable file 中的偏移量可以从段表中的 offset 字段获得，没必要记录在符号表里。）

####ELF符号包含如下几个部分：
#####变量名：4个
* 全局变量：`global_init_var`，`global_uninit_var`
	* 全局变量对链接器有意义，其可见性是 GLOBAL 的
* static变量：`static_var`，`static_var2`
	* static 变量对链接器没意义，其可见性是 LOCAL 的。链接器往往忽略这种符号。
#####函数名：3个
* printf
* func1
* main
#####段名：7个
* ELF只把部分段名算作了符号，这些段必须是 PROGBITS 或者 NOBITS 类型的，即这些段是要放到可执行文件里去的：
	* .text
	* .data
	* .bss
	* .rodata
	* .note.GNU-stack
	* .eh_frame
	* .comment
#####默认符号：2个
* 下标为0的UND
* 下标为1的源文件名：

		   Num:    Value          Size Type    Bind   Vis      Ndx Name
		     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND 
		     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS SimpleSection.c

#### 为何PE中段有20个（0x14个）符号，而ELF中只有16个符号？ 相差的这4个是什么玩楞？
* 因为不同的编译器/目标文件格式不同，所以除了变量名和函数名是所有编译器生成的目标文件都一定会有的之外，像段名、默认符号这种由编译器自动添加的符号，对不同的编译器来说是不尽相同的。
* 所以 Windows 的目标文件里有 20 个符号，比 Linux 的多了4个也是正常现象，不比深究。
* 总之那4个变量和3个函数都在就对了。

---
###符号重定位
* 重定位的目标一般指的是该符号在程序运行阶段的虚拟地址，而不是其在可执行文件中的位置（偏移量）
* 符号不止是变量名、函数名。同样，需要重定义的符号也不止变量名、函数名。
#####合并同类段
* 链接器在链接多个目标文件时，首先把他们相同的段合并。
* 原来每个 relocatable file 中都有各自的 .text, .data 段，合并后输出的文件中只有一个 .text，.data 段了
* 这时可以确定所有合并后的段在输出文件中的虚拟地址了。总的起始地址按照操作系统要求分配（比如0x08048000），然后累加各个 .o 文件中相同段的 size 即可。
* 并且此时链接器会记住合并的段里，从哪到到哪是来自于 a.o， 从哪到哪是来自于 b.o
* 

---
### 重定位表和符号表
* 重定位表
* 符号表

---
* 按照第4章的说法，链接器合并段，并把所有的符号进行重定位。
* 难道只有“符号”需要重定位吗？
* 符号表是一个段吗？貌似在ELF中算是，在PE/COFF中不算是？？

---

* 符号表是给链接器用的，可执行文件中不需要符号表，对吗？
* 目标文件（relocatable file）必须有符号表吗？